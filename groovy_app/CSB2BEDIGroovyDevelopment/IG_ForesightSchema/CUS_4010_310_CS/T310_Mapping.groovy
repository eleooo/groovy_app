import groovy.xml.MarkupBuilder
import java.sql.Connection


String mapping(String inputXmlBody, String[] runtimeParams, Connection conn) {

	cs.b2b.core.mapping.util.MappingUtil util = new cs.b2b.core.mapping.util.MappingUtil();

	/**
	 * Part I: prep handling here, 
	 */
	//inputXmlBody = util.removeBOM(inputXmlBody)

	/**
	 * Part II: get OLL mapping runtime parameters
	 */
	def appSessionId = util.getRuntimeParameter("AppSessionID", runtimeParams);
	def sourceFileName = util.getRuntimeParameter("OriginalSourceFileName", runtimeParams);
	def TP_ID = util.getRuntimeParameter("TP_ID", runtimeParams);
	def MSG_TYPE_ID = util.getRuntimeParameter("MSG_TYPE_ID", runtimeParams);
	def DIR_ID = util.getRuntimeParameter("DIR_ID", runtimeParams);
	def MSG_REQ_ID = util.getRuntimeParameter("MSG_REQ_ID", runtimeParams);

	/**
	 * Part III: read xml and prepare output xml
	 */
	def parser = new XmlParser()
	parser.setNamespaceAware(false)
	//Important: the inputXml is xml root element
	def ContainerMovement = parser.parseText(inputXmlBody);

	
	def writer = new StringWriter()
	def outXml = new MarkupBuilder(new IndentPrinter(new PrintWriter(writer), "", false));
	outXml.mkp.xmlDeclaration(version: "1.0", encoding: "utf-8")

	/**
	 * Part IV: mapping script start from here
	 */

	TimeZone.setDefault(TimeZone.getTimeZone('GMT+8'))
	def currentSystemDt = new Date()
	//please update foramt here
	def msgFmtId = "X.12"
	def ctrlNos = util.getEDIControlNumber("CARGOSMART", TP_ID, MSG_TYPE_ID, msgFmtId, conn)
	long ediIsaCtrlNumber = ctrlNos[0]
	long ediGroupCtrlNum = ctrlNos[1]

	outXml.'T310' {
		'ISA' {
			'I01_01' ''
			'I02_02' ''
			'I03_03' ''
			'I04_04' ''
			'I05_05' ''
			'I06_06' ''
			'I05_07' ''
			'I07_08' ''
			'I08_09' ''
			'I09_10' ''
			'I10_11' ''
			'I11_12' ''
			'I12_13' ''
			'I13_14' ''
			'I14_15' ''
			'I15_16' ''
		}
		'GS' {
			'E479_01' ''
			'E142_02' ''
			'E124_03' ''
			'E373_04' ''
			'E337_05' ''
			'E28_06' ''
			'E455_07' ''
			'E480_08' ''
		}
		'Loop_ST' {
			'ST' {
				'E143_01' ''
				'E329_02' ''
			}
			'B3' {
				'E147_01' ''
				'E76_02' ''
				'E145_03' ''
				'E146_04' ''
				'E188_05' ''
				'E373_06' ''
				'E193_07' ''
				'E202_08' ''
				'E32_09' ''
				'E374_10' ''
				'E140_11' ''
				'E373_12' ''
				'E375_13' ''
				'E335_14' ''
			}
			'B2A' {
				'E353_01' ''
				'E346_02' ''
			}
			'Y6' {
				'E313_01' ''
				'E151_02' ''
				'E275_03' ''
			}
			'G3' {
				'E315_01' ''
				'E317_02' ''
				'E93_03' ''
				'E201_04' ''
				'E782_05' ''
				'E73_06' ''
			}
			'N9' {
				'E128_01' ''
				'E127_02' ''
				'E369_03' ''
				'E373_04' ''
				'E337_05' ''
				'E623_06' ''
				'C040_07' {
					'E128_01' ''
					'E127_02' ''
					'E128_03' ''
					'E127_04' ''
					'E128_05' ''
					'E127_06' ''
				}
			}
			'V1' {
				'E597_01' ''
				'E182_02' ''
				'E26_03' ''
				'E55_04' ''
				'E140_05' ''
				'E249_06' ''
				'E854_07' ''
				'E897_08' ''
				'E91_09' ''
			}
			'M0' {
				'E250_01' ''
				'E373_02' ''
				'E373_03' ''
				'E373_04' ''
			}
			'M1' {
				'E26_01' ''
				'E14_02' ''
				'E74_03' ''
				'E122_04' ''
				'E98_05' ''
				'E61_06' ''
				'E122_07' ''
				'E782_08' ''
				'E1004_09' ''
				'E954_10' ''
				'E1004_11' ''
				'E954_12' ''
			}
			'C2' {
				'E8_01' ''
				'E66_02' ''
				'E67_03' ''
				'E20_04' ''
				'E7_05' ''
				'E107_06' ''
				'E373_07' ''
			}
			'C3' {
				'E100_01' ''
				'E280_02' ''
				'E100_03' ''
				'E100_04' ''
			}
			'Y2' {
				'E95_01' ''
				'E78_02' ''
				'E56_03' ''
				'E24_04' ''
				'E91_05' ''
				'E177_06' ''
				'E140_07' ''
				'E464_08' ''
				'E465_09' ''
				'E466_10' ''
			}
			'Loop_N1' {
				'N1' {
					'E98_01' ''
					'E93_02' ''
					'E66_03' ''
					'E67_04' ''
					'E706_05' ''
					'E98_06' ''
				}
				'N2' {
					'E93_01' ''
					'E93_02' ''
				}
				'N3' {
					'E166_01' ''
					'E166_02' ''
				}
				'N4' {
					'E19_01' ''
					'E156_02' ''
					'E116_03' ''
					'E26_04' ''
					'E309_05' ''
					'E310_06' ''
				}
			}
			'G61' {
				'E366_01' ''
				'E93_02' ''
				'E365_03' ''
				'E364_04' ''
				'E443_05' ''
			}
			'Loop_R4' {
				'R4' {
					'E115_01' ''
					'E309_02' ''
					'E310_03' ''
					'E114_04' ''
					'E26_05' ''
					'E174_06' ''
					'E113_07' ''
					'E156_08' ''
				}
				'DTM' {
					'E374_01' ''
					'E373_02' ''
					'E337_03' ''
					'E623_04' ''
					'E1250_05' ''
					'E1251_06' ''
				}
			}
			'R2A' {
				'E133_01' ''
				'E1431_02' ''
				'E91_03' ''
				'E140_04' ''
				'E309_05' ''
				'E310_06' ''
				'E56_07' ''
				'E1_08' ''
				'E742_09' ''
				'E98_10' ''
			}
			'R2' {
				'E140_01' ''
				'E133_02' ''
				'E19_03' ''
				'E154_04' ''
				'E177_05' ''
				'E91_06' ''
				'E296_07' ''
				'E296_08' ''
				'E76_09' ''
				'E373_10' ''
				'E369_11' ''
				'E56_12' ''
				'E742_13' ''
			}
			'K1' {
				'E61_01' ''
				'E61_02' ''
			}
			'H3' {
				'E152_01' ''
				'E153_02' ''
				'E241_03' ''
				'E242_04' ''
				'E257_05' ''
			}
			'L5' {
				'E213_01' ''
				'E79_02' ''
				'E22_03' ''
				'E23_04' ''
				'E103_05' ''
				'E87_06' ''
				'E88_07' ''
				'E23_08' ''
				'E22_09' ''
				'E595_10' ''
			}
			'Loop_C8' {
				'C8' {
					'E213_01' ''
					'E246_02' ''
					'E247_03' ''
					'E1302_04' ''
				}
				'C8C' {
					'E247_01' ''
					'E247_02' ''
					'E247_03' ''
				}
			}
			'Loop_LX' {
				'LX' {
					'E554_01' ''
				}
				'Loop_N7' {
					'N7' {
						'E206_01' ''
						'E207_02' ''
						'E81_03' ''
						'E187_04' ''
						'E167_05' ''
						'E232_06' ''
						'E205_07' ''
						'E183_08' ''
						'E184_09' ''
						'E102_10' ''
						'E40_11' ''
						'E140_12' ''
						'E319_13' ''
						'E219_14' ''
						'E567_15' ''
						'E571_16' ''
						'E188_17' ''
						'E761_18' ''
						'E56_19' ''
						'E65_20' ''
						'E189_21' ''
						'E24_22' ''
						'E140_23' ''
						'E301_24' ''
					}
					'QTY' {
						'E673_01' ''
						'E380_02' ''
						'C001_03' {
							'E355_01' ''
							'E1018_02' ''
							'E649_03' ''
							'E355_04' ''
							'E1018_05' ''
							'E649_06' ''
							'E355_07' ''
							'E1018_08' ''
							'E649_09' ''
							'E355_10' ''
							'E1018_11' ''
							'E649_12' ''
							'E355_13' ''
							'E1018_14' ''
							'E649_15' ''
						}
						'E61_04' ''
					}
					'V4' {
						'E877_01' ''
					}
					'N12' {
						'E829_01' ''
						'C001_02' {
							'E355_01' ''
							'E1018_02' ''
							'E649_03' ''
							'E355_04' ''
							'E1018_05' ''
							'E649_06' ''
							'E355_07' ''
							'E1018_08' ''
							'E649_09' ''
							'E355_10' ''
							'E1018_11' ''
							'E649_12' ''
							'E355_13' ''
							'E1018_14' ''
							'E649_15' ''
						}
					}
					'M7' {
						'E225_01' ''
						'E225_02' ''
						'E225_03' ''
						'E225_04' ''
						'E98_05' ''
					}
					'W09' {
						'E40_01' ''
						'E408_02' ''
						'E355_03' ''
						'E408_04' ''
						'E355_05' ''
						'E3_06' ''
						'E1122_07' ''
						'E488_08' ''
						'E380_09' ''
					}
					'Loop_L1' {
						'L1' {
							'E213_01' ''
							'E60_02' ''
							'E122_03' ''
							'E58_04' ''
							'E191_05' ''
							'E117_06' ''
							'E120_07' ''
							'E150_08' ''
							'E121_09' ''
							'E39_10' ''
							'E16_11' ''
							'E276_12' ''
							'E257_13' ''
							'E74_14' ''
							'E122_15' ''
							'E372_16' ''
							'E220_17' ''
							'E221_18' ''
							'E954_19' ''
							'E100_20' ''
							'E610_21' ''
						}
						'C3' {
							'E100_01' ''
							'E280_02' ''
							'E100_03' ''
							'E100_04' ''
						}
					}
					'L7' {
						'E213_01' ''
						'E168_02' ''
						'E171_03' ''
						'E172_04' ''
						'E169_05' ''
						'E170_06' ''
						'E59_07' ''
						'E173_08' ''
						'E46_09' ''
						'E373_10' ''
						'E119_11' ''
						'E227_12' ''
						'E294_13' ''
						'E295_14' ''
						'E19_15' ''
						'E156_16' ''
					}
					'X1' {
						'E83_01' ''
						'E50_02' ''
						'E51_03' ''
						'E373_04' ''
						'E52_05' ''
						'E48_06' ''
						'E26_07' ''
						'E141_08' ''
						'E210_09' ''
						'E80_10' ''
						'E148_11' ''
						'E47_12' ''
						'E355_13' ''
						'E212_14' ''
						'E1306_15' ''
						'E67_16' ''
					}
					'X2' {
						'E70_01' ''
						'E373_02' ''
						'E373_03' ''
						'E70_04' ''
						'E373_05' ''
						'E373_06' ''
					}
					'N9' {
						'E128_01' ''
						'E127_02' ''
						'E369_03' ''
						'E373_04' ''
						'E337_05' ''
						'E623_06' ''
						'C040_07' {
							'E128_01' ''
							'E127_02' ''
							'E128_03' ''
							'E127_04' ''
							'E128_05' ''
							'E127_06' ''
						}
					}
					'Loop_H1' {
						'H1' {
							'E62_01' ''
							'E209_02' ''
							'E208_03' ''
							'E64_04' ''
							'E63_05' ''
							'E200_06' ''
							'E77_07' ''
							'E355_08' ''
							'E254_09' ''
						}
						'H2' {
							'E64_01' ''
							'E274_02' ''
						}
					}
				}
				'Loop_L0' {
					'L0' {
						'E213_01' ''
						'E220_02' ''
						'E221_03' ''
						'E81_04' ''
						'E187_05' ''
						'E183_06' ''
						'E184_07' ''
						'E80_08' ''
						'E211_09' ''
						'E458_10' ''
						'E188_11' ''
						'E56_12' ''
						'E380_13' ''
						'E211_14' ''
						'E1073_15' ''
					}
					'L5' {
						'E213_01' ''
						'E79_02' ''
						'E22_03' ''
						'E23_04' ''
						'E103_05' ''
						'E87_06' ''
						'E88_07' ''
						'E23_08' ''
						'E22_09' ''
						'E595_10' ''
					}
					'Loop_L1' {
						'L1' {
							'E213_01' ''
							'E60_02' ''
							'E122_03' ''
							'E58_04' ''
							'E191_05' ''
							'E117_06' ''
							'E120_07' ''
							'E150_08' ''
							'E121_09' ''
							'E39_10' ''
							'E16_11' ''
							'E276_12' ''
							'E257_13' ''
							'E74_14' ''
							'E122_15' ''
							'E372_16' ''
							'E220_17' ''
							'E221_18' ''
							'E954_19' ''
							'E100_20' ''
							'E610_21' ''
						}
						'C3' {
							'E100_01' ''
							'E280_02' ''
							'E100_03' ''
							'E100_04' ''
						}
					}
					'L7' {
						'E213_01' ''
						'E168_02' ''
						'E171_03' ''
						'E172_04' ''
						'E169_05' ''
						'E170_06' ''
						'E59_07' ''
						'E173_08' ''
						'E46_09' ''
						'E373_10' ''
						'E119_11' ''
						'E227_12' ''
						'E294_13' ''
						'E295_14' ''
						'E19_15' ''
						'E156_16' ''
					}
					'X1' {
						'E83_01' ''
						'E50_02' ''
						'E51_03' ''
						'E373_04' ''
						'E52_05' ''
						'E48_06' ''
						'E26_07' ''
						'E141_08' ''
						'E210_09' ''
						'E80_10' ''
						'E148_11' ''
						'E47_12' ''
						'E355_13' ''
						'E212_14' ''
						'E1306_15' ''
						'E67_16' ''
					}
					'X2' {
						'E70_01' ''
						'E373_02' ''
						'E373_03' ''
						'E70_04' ''
						'E373_05' ''
						'E373_06' ''
					}
					'Loop_C8' {
						'C8' {
							'E213_01' ''
							'E246_02' ''
							'E247_03' ''
							'E1302_04' ''
						}
						'C8C' {
							'E247_01' ''
							'E247_02' ''
							'E247_03' ''
						}
					}
					'Loop_H1' {
						'H1' {
							'E62_01' ''
							'E209_02' ''
							'E208_03' ''
							'E64_04' ''
							'E63_05' ''
							'E200_06' ''
							'E77_07' ''
							'E355_08' ''
							'E254_09' ''
						}
						'H2' {
							'E64_01' ''
							'E274_02' ''
						}
					}
				}
			}
			'L3' {
				'E81_01' ''
				'E187_02' ''
				'E60_03' ''
				'E122_04' ''
				'E58_05' ''
				'E191_06' ''
				'E117_07' ''
				'E150_08' ''
				'E183_09' ''
				'E184_10' ''
				'E80_11' ''
				'E188_12' ''
				'E171_13' ''
				'E74_14' ''
				'E122_15' ''
			}
			'PWK' {
				'E755_01' ''
				'E756_02' ''
				'E757_03' ''
				'E98_04' ''
				'E66_05' ''
				'E67_06' ''
				'E352_07' ''
				'C002_08' {
					'E704_01' ''
					'E704_02' ''
					'E704_03' ''
					'E704_04' ''
					'E704_05' ''
				}
				'E1525_09' ''
			}
			'Loop_L1' {
				'L1' {
					'E213_01' ''
					'E60_02' ''
					'E122_03' ''
					'E58_04' ''
					'E191_05' ''
					'E117_06' ''
					'E120_07' ''
					'E150_08' ''
					'E121_09' ''
					'E39_10' ''
					'E16_11' ''
					'E276_12' ''
					'E257_13' ''
					'E74_14' ''
					'E122_15' ''
					'E372_16' ''
					'E220_17' ''
					'E221_18' ''
					'E954_19' ''
					'E100_20' ''
					'E610_21' ''
				}
				'C3' {
					'E100_01' ''
					'E280_02' ''
					'E100_03' ''
					'E100_04' ''
				}
			}
			'V9' {
				'E304_01' ''
				'E106_02' ''
				'E373_03' ''
				'E337_04' ''
				'E19_05' ''
				'E156_06' ''
				'E26_07' ''
				'E641_08' ''
				'E154_09' ''
				'E380_10' ''
				'E1274_11' ''
				'E61_12' ''
				'E623_13' ''
				'E380_14' ''
				'E154_15' ''
				'E86_16' ''
				'E86_17' ''
				'E86_18' ''
				'E81_19' ''
				'E82_20' ''
			}
			'C8' {
				'E213_01' ''
				'E246_02' ''
				'E247_03' ''
				'E1302_04' ''
			}
			'K1' {
				'E61_01' ''
				'E61_02' ''
			}
			'L11' {
				'E127_01' ''
				'E128_02' ''
				'E352_03' ''
			}
			'SE' {
				'E96_01' ''
				'E329_02' ''
			}
		}
		'GE' {
			'E97_01' ''
			'E28_02' ''
		}
		'IEA' {
			'I16_01' ''
			'I12_02' ''
		}
	}
	
}
